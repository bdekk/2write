<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="quill-import.html">
<link rel="import" href="html-markdown.html">

<dom-module id="write-editor">
  <template>
    <style>
      :host {
        display: block;

        padding: 10px;
      }
    </style>
    <div id="toolbar">
      <button class="ql-bold">Bold</button>
      <button class="ql-italic">Italic</button>
    </div>
    <html-markdown id="h2m"></html-markdown>
    <div id="editor" inner-h-t-m-l="{{html}}"></div>
  </template>


  <script>
    class Editor extends Polymer.Element {
      static get is() { return 'write-editor'; }

      static get properties() {
        return {
          content: {
            type: String,
            notify: true,
            reflectOnAttribute: true
          },
          quill: {
            type: Object,
            value: null
          }
        };
      }

      ready() {
        super.ready();
        var toolbarOptions = ['bold', 'italic', 'underline', 'strike']; 
        var quill = new Quill(this.$.editor, {
            modules: { toolbar: {container: this.$.toolbar} },
            theme: 'snow'
        });
        
        this.quill = quill;

        this.html = this.$.h2m.toHTML(this.content);

        this.quill.on('text-changed', this._textChanged);
      }

      getContent() {
        return this.content;
      }

      _textChanged(event) {
          // this.dispatchEvent(new CustomEvent('text-changed',  {detail: {event}}));
          this.content = this.$.h2m.toMarkdown(this.html);
      }
    }

    window.customElements.define(Editor.is, Editor);
  </script>
</dom-module>
